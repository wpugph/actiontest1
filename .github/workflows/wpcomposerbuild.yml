name: CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1
    - name: Setup SSH access to Pantheon
      run: |
        eval $(ssh-agent -s) #ok
        mkdir -p ~/.ssh #ok
        export PATH="$PATH:$COMPOSER_HOME/vendor/bin"
        export PROJECT_ROOT="$(pwd)"
        export HTDOCS="$HOME/htdocs"
        export GITHUB_BRANCH=${GITHUB_REF##*heads/}
        export CI_SCRIPT_OPTIONS="ci_script_options"
        export PANTHEONEMAIL="cralberto11@gmail.com"
        export PANTHEONSITENAME="carltest1"
        export PANTHEONSITEUUID="01507cf9-d5e7-460d-83ee-5587a03e7d9a"
        export PANTHEONENV="dev"
        printf "[\e[0;34mNOTICE\e[0m] Setting up SSH access to server.\n"
        SSH_DIR="$HOME/.ssh"
        mkdir -p "$SSH_DIR"
        chmod 700 "$SSH_DIR"
        touch "$SSH_DIR/id_rsa1"
        echo "$SSH_DIR/id_rsa1"
        echo "${{ secrets.STAGING_PRIVATE_KEY }}"
        echo "${{ secrets.STAGING_PRIVATE_KEY }}" > "$SSH_DIR/id_rsa1"
        chmod 600 "$SSH_DIR/id_rsa1"
        eval "$(ssh-agent -s)"
        ssh-add "$SSH_DIR/id_rsa1"
        ssh-add -l
        echo "SSH PRIVATE KEY IMPORTED!!!"
        curl -O https://raw.githubusercontent.com/pantheon-systems/terminus-installer/master/builds/installer.phar && php installer.phar install
        # composer global require consolidation/cgr
        # cgr --stability RC pantheon-systems/terminus
        /home/runner/work/actiontest1/actiontest1/vendor/bin/terminus self:info
        composer update
        ls web -al   
        ls web/wp -al
        npm -v



    # - name: ssh-add 2 method
    #   uses: webfactory/ssh-agent@v0.1.1
    #   with:
    #       STAGING_PRIVATE_KEY: ${{ secrets.STAGING_PRIVATE_KEY }}

    - name: Run WP composer build
      run: |
        ssh-add -l
        echo Add other actions to build,
        echo test, and deploy your project.
        composer update
        ls web -al   
        ls web/wp -al

    - name: Run WP Visual regression test
      run: |
        echo Add other actions to build,
        echo test, and deploy your project.
        composer update
        ls web -al   
        ls web/wp -al   
